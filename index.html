<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maandamano Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Navigation -->
  <nav class="bg-red-600 text-white shadow-md">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"></path>
        </svg>
        <span class="text-xl font-bold">Maandamano Tracker</span>
      </div>
      <a href="stats.html" class="px-3 py-1 bg-white text-red-600 rounded-md font-medium">View Stats</a>
    </div>
  </nav>

  <!-- Main Form -->
  <main class="container mx-auto px-4 py-8 max-w-md">
    <div class="bg-white rounded-lg shadow-md p-6">
      <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">Report Protest Activity</h1>
      
      <form id="reportForm" class="space-y-4">
        <!-- Protest Selection -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">Protest Type*</label>
          <select name="protest" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500" required>
            <option value="" disabled selected>Select protest</option>
            <option value="#SabaSaba">#SabaSaba</option>
            <option value="#RutoMustGo">#RutoMustGo</option>
          </select>
        </div>

        <!-- County Dropdown -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">County*</label>
          <select id="county" name="county" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500" required>
            <option value="" disabled selected>Select county</option>
            <option value="Nairobi">Nairobi</option>
            <option value="Mombasa">Mombasa</option>
            <!-- Add all 47 counties -->
          </select>
        </div>

        <!-- Constituency Dropdown -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">Constituency*</label>
          <select id="constituency" name="constituency" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500" required>
            <option value="" disabled selected>Select constituency</option>
            <!-- Dynamically populated -->
          </select>
        </div>

        <!-- Town Input -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">Town/Area*</label>
          <input type="text" name="town" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500" placeholder="e.g. Kibera, CBD" required>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
          Submit Report
        </button>
      </form>

      <!-- Success Message -->
      <div id="successMessage" class="hidden mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-md text-center">
        Report submitted successfully!
      </div>
    </div>
  </main>

  <script>
    // Constituency data - add all 290 for your county selections
    const constituencies = {
      "Nairobi": ["Dagoretti North", "Dagoretti South", /*...all Nairobi constituencies...*/],
      "Mombasa": ["Changamwe", "Jomvu", /*...*/]
      // Add all 47 counties
    };

    // County dropdown change handler
    document.getElementById('county').addEventListener('change', function() {
      const county = this.value;
      const constituencySelect = document.getElementById('constituency');
      constituencySelect.innerHTML = '<option value="" disabled selected>Select constituency</option>';
      
      if (county && constituencies[county]) {
        constituencies[county].forEach(con => {
          const option = document.createElement('option');
          option.value = con;
          option.textContent = con;
          constituencySelect.appendChild(option);
        });
      }
    });

    // Form submission
    document.getElementById('reportForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = {
        protest: this.protest.value,
        county: this.county.value,
        constituency: this.constituency.value,
        town: this.town.value,
        timestamp: new Date().toISOString()
      };

      try {
        const response = await fetch('/api/report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          document.getElementById('successMessage').classList.remove('hidden');
          this.reset();
          setTimeout(() => {
            document.getElementById('successMessage').classList.add('hidden');
          }, 3000);
        }
      } catch (error) {
        alert("Error submitting report. Please try again.");
      }
    });
  </script>
</body>
</html>